Worked on this over a weekend.
Still not completly finished and not tested.
The last bits of code are compleatly untested and probably doesn't work, as of 2025-10-19.